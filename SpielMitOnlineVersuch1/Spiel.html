<html>
    <head>
        <title>Multiplayer Demo</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <style>
            canvas {
                border: 1px solid black;

            }
        </style>

    </head>
    <body>


        <div>
 <canvas height="1000" width="1800" id="canvas" ></canvas>
    <br>
        </div>




        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
            import { getDatabase , ref, set, onValue} from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js"; 
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-analytics.js";
            import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
              apiKey: "AIzaSyAR_mO2zA2G6cW6mZDgN3IJMvlWtpkG0Bw",
              authDomain: "multiplayer-demo-1b39f.firebaseapp.com",
              databaseURL: "https://multiplayer-demo-1b39f-default-rtdb.europe-west1.firebasedatabase.app",
              projectId: "multiplayer-demo-1b39f",
              storageBucket: "multiplayer-demo-1b39f.appspot.com",
              messagingSenderId: "221766680112",
              appId: "1:221766680112:web:4e4c079d689b26937577f5",
              measurementId: "G-HPTQL92EKQ"
            };
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);

            // Initialize Realtime Database and get a reference to the service
            const database = getDatabase(app);

            const analytics = getAnalytics(app);

            const auth = getAuth();
                signInAnonymously(auth)
                    .then(() => {
                        
                    })
                 .catch((error) => {
                 const errorCode = error.code;
                 const errorMessage = error.message;
                 alert(errorMessage);
                 });
                 let UserID;
                 onAuthStateChanged(auth, (user) => {
                    if (user) {
                    // User is signed in, see docs for a list of available properties
                    // https://firebase.google.com/docs/reference/js/firebase.User
                    const uid = user.uid;
                    console.log(uid)
                    UserID = uid;
                     // ...
                      } else {
                      // User is signed out
                      // ...
                 }
                });
              /*  
                const starCountRef = ref(database, 'users/');
                onValue(starCountRef, (snapshot) => {
                const data = snapshot.val();
                console.log(data);
            });

*/
            var x = 0;
            var y = 0;
            let canvas = document.getElementById('canvas');

            //ctx ist der canvas, auf ihn wird zugegriffen um zu malen oder bilder einzuf√ºgen oder...
            let ctx = canvas.getContext('2d');

            var map = [];
        document.onkeydown = document.onkeyup = function(e) {
            e = e || event;
            map[e.keyCode] = e.type == 'keydown';
            /* insert conditional here */
            console.log(e.keyCode);
            if(map[68]){
                x +=20;
                
            }
            if(map[65]){
                x -=20;
                
            }

            if(map[83]){
                y +=20;
                
            }

            if(map[87]){
                y -=20;
                
            }

            ctx.fillStyle = 'white';
                ctx.fillRect(0,0,1000,1000);
                zeichneCharacter(x,y)
            console.log(x);
            writeUserData(x,y);
            
        }

        function writeUserData(xPosition, yPosition) {
                set(ref(database, 'test/','userID/','cool/'), {
                 xPos:xPosition,
                 yPos:yPosition,
                 userID:UserID
                });
            }

        function zeichneCharacter(xPos, yPos) { 
            ctx.fillStyle = '#F0DB4F';
            ctx.strokeStyle = 'red';
            ctx.strokeRect(xPos, yPos, 20, 20);
            ctx.fillRect( xPos, yPos,20, 20);
        }



          </script>

    </body>
</html>